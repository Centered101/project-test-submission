<!DOCTYPE html>
<html lang="th">

<head>
    <title>‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡∏¢‡∏ö‡∏±‡∏ï‡∏£</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="theme-color" content="#409EFE">
    <meta name="keywords" content="HTML, CSS, XML, JavaScript, TailwindCSS, jQuery, Certificate, Centered101">
    <meta name="author" content="Centered101">
    <meta name="description" content="‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡∏¢‡∏ö‡∏±‡∏ï‡∏£ ‡∏û‡∏á‡∏®‡πå‡∏û‡∏• ‡∏û‡∏£‡∏°‡∏ú‡∏≤">

    <meta property="og:type" content="website">
    <meta property="og:url" content="https://project-test-submission.netlify.app">
    <meta property="og:title" content="‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡∏¢‡∏ö‡∏±‡∏ï‡∏£">
    <meta property="og:description" content="‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡∏¢‡∏ö‡∏±‡∏ï‡∏£ ‡∏û‡∏á‡∏®‡πå‡∏û‡∏• ‡∏û‡∏£‡∏°‡∏ú‡∏≤">
    <meta property="og:image" content="/images/icon.svg">

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://project-test-submission.netlify.app">
    <meta property="twitter:title" content="‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡∏¢‡∏ö‡∏±‡∏ï‡∏£">
    <meta property="twitter:description" content="‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡∏¢‡∏ö‡∏±‡∏ï‡∏£ ‡∏û‡∏á‡∏®‡πå‡∏û‡∏• ‡∏û‡∏£‡∏°‡∏ú‡∏≤">
    <meta property="twitter:image" content="/images/icon.svg">

    <link rel="shortcut icon" type="image/x-icon" href="/images/icon.svg">
    <link rel="stylesheet" href="https://asia-lb.firebaseapp.com/style/index.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">

    <script src=https://cdn.tailwindcss.com></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
</head>

<style>
    :root {
        --primary-color: #409EFE;
    }

    mark {
        background-color: var(--primary-color) !important;
        color: #FFFFFF;
        transition: color;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        /* ease-in-out */
        transition-duration: 300ms
    }

    .slide-up {
        animation: slideUp 300ms ease;
    }

    @keyframes slideUp {
        from {
            transform: translateY(100px);
            opacity: 0;
        }

        to {
            transform: translateY(0);
            opacity: 1;
        }
    }

    .stamp-icon {
        opacity: 0;
        transform: translateY(120px) scale(1.4);
        animation: stampDown 2s cubic-bezier(.2, .9, .3, 1.2) forwards;
        animation-delay: 1500ms;
    }

    @keyframes stampDown {
        0% {
            opacity: 0;
            transform: translateY(-120px) rotate(180deg) scale(1.4);
        }

        60% {
            opacity: 1;
            transform: translateY(10px) rotate(0deg) scale(0.95);
        }

        80% {
            transform: translateY(-4px) rotate(0deg) scale(1.02);
        }

        100% {
            opacity: 1;
            transform: translateY(0) rotate(0deg) scale(1);
        }
    }

    .brop-icon {
        opacity: 0;
        transform: translateY(-120px) rscale(1.4);
        animation: bropDown 1s cubic-bezier(.2, .9, .3, 1.2) forwards;
        animation-delay: 500ms;
    }

    @keyframes bropDown {
        0% {
            opacity: 0;
            transform: translateY(-120px) rotate(90deg) scale(1.4);
        }

        60% {
            opacity: 1;
            transform: translateY(10px) rotate(0deg) scale(0.90);
        }

        80% {
            transform: translateY(-4px) rotate(10deg) scale(1.02);
        }

        100% {
            opacity: 1;
            transform: translateY(0) rotate(0deg) scale(1);
        }
    }
</style>

<body class="bg-gray-50 min-h-screen overflow-x-hidden">
    <!-- Header -->
    <header data-aos="fade-down" data-aos-duration="3000"
        class="mx-auto bg-[color:var(--primary-color)] text-white text-center shadow-lg py-8">
        <h1 class="text-4xl font-bold">‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡∏¢‡∏ö‡∏±‡∏ï‡∏£</h1>
    </header>

    <nav data-aos="fade-down" data-aos-duration="2700"
        class="bg-[color:var(--white-smoker)] border shadow sticky top-0 z-30">
        <div class="max-w-7xl mx-auto flex items-center justify-between gap-2 px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <button id="student-btn" onclick="window.scrollTo({ top: 0, behavior: 'smooth' })"
                    class="ripple-effect flex items-center gap-2 rounded cursor-pointer">
                    <div
                        class="flex items-center justify-center bg-[color:var(--primary-color)] rounded-md text-white font-bold overflow-hidden">
                        <img src="https://mycourseville-default.s3.ap-southeast-1.amazonaws.com/user_files/392/1408392/profilepict/profilepict-1408392-17542882116511.png"
                            alt="‡∏û‡∏á‡∏®‡πå‡∏û‡∏• ‡∏û‡∏£‡∏°‡∏ú‡∏≤" class="size-12 object-cover" draggable="false" />
                    </div>
                    <span class="font-semibold text-2xl pr-2">‡∏û‡∏á‡∏®‡πå‡∏û‡∏• ‡∏û‡∏£‡∏°‡∏ú‡∏≤</span>
                </button>
            </div>
            <a href="upcertificates.html"
                class="btn-text flex items-center gap-1 text-sm bg-gray-50 border rounded-md shadow-inner p-2 overflow-hidden"><i
                    class="fas fa-upload"></i><span>upload</span></a>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl space-y-8 mx-auto p-4 py-6">
        <!-- Filter Section -->
        <section data-aos="fade-down" data-aos-duration="1500"
            class="bg-[color:var(--white-smoker)] border rounded-2xl shadow space-y-4 p-4 md:p-6 overflow-hidden">
            <h3 class="flex items-center gap-2 text-lg font-semibold">
                <i class="fas fa-search text-[color:var(--primary-color)]"></i>
                ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡∏¢‡∏ö‡∏±‡∏ï‡∏£
            </h3>

            <div class="flex flex-col gap-2 md:gap-4">
                <!-- Search Input -->
                <div>
                    <label for="search-input" class="block text-sm font-medium text-gray-400 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£</label>
                    <div class="relative">
                        <input type="text" id="search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£..."
                            class="w-full bg-gray-50 border rounded-lg shadow-inner px-4 py-2 pl-10 focus:ring-2 focus:ring-[color:var(--primary-color)]">
                        <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                    </div>
                </div>

                <div class="flex items-center gap-2 md:gap-4 *:flex-1">
                    <!-- Year Filter -->
                    <div class="space-y-2">
                        <label for="year-filter" class="block text-sm font-medium text-gray-400">‡∏õ‡∏µ</label>
                        <select id="year-filter"
                            class="w-full bg-gray-50 border rounded-lg shadow-inner px-4 py-2 focus:ring-2 focus:ring-[color:var(--primary-color)]">
                            <option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ</option>
                        </select>
                    </div>
                    <!-- issuer Filter -->
                    <div class="space-y-2">
                        <label for="issuer-filter" class="block text-sm font-medium text-gray-400">‡∏ú‡∏π‡πâ‡∏≠‡∏≠‡∏Å</label>
                        <select id="issuer-filter"
                            class="w-full bg-gray-50 border rounded-lg shadow-inner px-4 py-2 focus:ring-2 focus:ring-[color:var(--primary-color)]">
                            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        </select>
                    </div>
                    <!-- type Filter -->
                    <div class="space-y-2">
                        <label for="type-filter" class="block text-sm font-medium text-gray-400">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
                        <select id="type-filter"
                            class="w-full bg-gray-50 border rounded-lg shadow-inner px-4 py-2 focus:ring-2 focus:ring-[color:var(--primary-color)]">
                            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="flex justify-between gap-2 md:gap-4 text-sm mt-4 pt-4 border-t-2">
                <button id="clear-filters"
                    class="ripple-effect flex items-center justify-center bg-gray-50 border rounded-lg shadow-inner px-4 py-2 overflow-hidden">
                    <span class="flex items-center gap-2">
                        <i class="fas fa-times"></i>
                        <span class="hidden md:block">
                            ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
                        </span>
                    </span>
                </button>

                <div id="results-count" class="flex-1 bg-gray-50 border rounded-lg shadow-inner px-4 py-2">
                    <span class="flex items-center gap-2"><i class="fa-regular fa-compass fa-spin"></i>
                        <p class="line-clamp-1">
                            ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </p>
                    </span>
                </div>

                <div class="flex gap-2 md:gap-4">
                    <button data-cols="1"
                        class="grid-btn bg-gray-50 text-center border rounded-lg shadow-inner px-4 py-2 overflow-hidden">
                        <i class="fa-solid fa-list"></i>
                    </button>

                    <button data-cols="2"
                        class="grid-btn bg-gray-50 text-center border rounded-lg shadow-inner px-4 py-2 overflow-hidden">
                        <i class="fa-solid fa-grip-vertical"></i>
                    </button>

                    <button data-cols="3"
                        class="hidden sm:block grid-btn bg-gray-50 text-center border rounded-lg shadow-inner px-4 py-2 overflow-hidden">
                        <i class="fa-solid fa-grip"></i>
                    </button>
                </div>

            </div>
        </section>

        <!-- Certificates Section -->
        <section id="certificates-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
            <!-- Loading placeholder -->
            <div data-aos="fade-up" class="col-span-full text-center space-y-2 py-36">
                <div
                    class="size-16 border-8 border-y-transparent rounded-full animate-spin border-[color:var(--primary-color)] mx-auto mb-4">
                </div>
                <p class="text-xl">
                    ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </p>
                <p class="text-gray-400">
                    ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡∏¢‡∏ö‡∏±‡∏ï‡∏£
                </p>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="text-center text-sm text-gray-500 py-12">
        <p>
            <script>
                document.write("¬©&#8201;" + (new Date().getFullYear()))
            </script>
            <a href="https://project-test-submission.netlify.app/centered101/" target="_blank" rel="noopener noreferrer"
                class="btn-text text-[color:var(--primary-color)] p-0">Centered101</a>
            <span>‚Ä¢&#8201;mycert&#8201;‚Äî&#8201;All rights reserved.</span>
        </p>
    </footer>

    <script>

        // =====================================================================
        // CERTIFICATE VIEWER - Main Script
        // =====================================================================

        // ---------------------------------------------------------------------
        // 1. CONFIGURATION & GLOBAL VARIABLES
        // ---------------------------------------------------------------------

        const CONFIG = {
            sheetId: "17ppLfag2cZb1_-dPeRKqdoaDpFyHjU6vykr9DEOwS1c",
            sheetName: "Sheet1",
            noImageUrl: "https://project-test-submission.netlify.app/images/img/noitems.svg"
        };

        const STATE = {
            allCertificates: [],
            certificateDataStore: {}
        };

        // Google Sheets API URL
        const SHEET_URL = `https://docs.google.com/spreadsheets/d/${CONFIG.sheetId}/gviz/tq?sheet=${CONFIG.sheetName}`;

        // ---------------------------------------------------------------------
        // 2. UTILITY FUNCTIONS
        // ---------------------------------------------------------------------

        /**
        * ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å Google Sheets ‡πÄ‡∏õ‡πá‡∏ô Date object
        */
        function parseCertDate(sheetDate) {
            if (!sheetDate) return new Date(0);

            // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Date(yyyy,mm,dd)
            const match = sheetDate.match(/Date\((\d+),(\d+),(\d+)\)/);
            if (match) {
                return new Date(parseInt(match[1]), parseInt(match[2]), parseInt(match[3]));
            }

            // ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö yyyy-mm-dd
            if (sheetDate.includes('-')) {
                return new Date(sheetDate);
            }

            return new Date(0);
        }

        /**
        * ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
        */
        function formatDateThai(sheetDate) {
            if (!sheetDate) return "";

            const THAI_MONTHS = [
                "‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°",
                "‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå",
                "‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°",
                "‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô",
                "‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°",
                "‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô",
                "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°",
                "‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°",
                "‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô",
                "‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°",
                "‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô",
                "‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"
            ];

            const date = parseCertDate(sheetDate);
            if (date.getTime() === 0) return sheetDate;

            return `${date.getDate()} ${THAI_MONTHS[date.getMonth()]} ${date.getFullYear()}`;
        }

        /**
        * ‡πÑ‡∏Æ‡πÑ‡∏•‡∏ï‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
        */
        function highlightText(text, searchTerm) {
            if (!searchTerm || !text) return text || '';

            const escapedTerm = searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            const regex = new RegExp(`(${escapedTerm})`, 'gi');

            return text.replace(regex, '<mark>$1</mark>');
        }

        /**
        * ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô XSS ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£ escape HTML
        */
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ---------------------------------------------------------------------
        // 3. MODAL FUNCTIONS
        // ---------------------------------------------------------------------

        /**
        * ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏Ç‡∏≠‡∏á Modal
        */
        function createImageModal() {
            const modalHTML = `
        <div id="image-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex flex-col items-center justify-evenly sm:justify-center p-4 z-40">
        <div onclick="event.stopPropagation()" class="slide-up relative max-h-[80%] max-w-7xl w-full grid grid-cols-1 md:grid-cols-2 bg-[color:var(--white-smoker)] shadow">

        <!-- ID Badge -->
        <span class="stamp-icon absolute -top-10 left-[25%] text-center">
        <i class="fa-solid fa-certificate absolute inset-0 flex items-center justify-center text-8xl text-[color:var(--primary-color)] drop-shadow-lg z-0"></i>
        <span id="modal-cert-id" class="relative text-white text-2xl font-medium z-10"></span>
        </span>

        <!-- Image Section -->
        <div class="relative flex items-center justify-center border-b md:border-b-0 md:border-r overflow-hidden">
        <img id="modal-image"
        src=""
        alt=""
        class="aspect-auto w-full min-h-full md:max-h- object-contain"
        style="background-image:url('${CONFIG.noImageUrl}'); background-size:cover; background-position:center;"
        onerror="this.src='${CONFIG.noImageUrl}'"
        draggable="false">
        </div>

        <!-- Details Section -->
        <div id="modal-details" class="hidden md:flex flex-col bg-[color:var(--white-smoker)] space-y-2 p-4"></div>
        </div>

        <!-- Close Hint -->
        <span class="brop-icon sm:absolute bottom-8 bg-[color:var(--white-smoker)] border rounded px-2 py-1 select-none">
        ‡πÅ‡∏ï‡∏∞‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏¥‡∏î
        </span>
        </div>
        `;

            $('body').append(modalHTML);

            // ‡∏õ‡∏¥‡∏î modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
            $('#image-modal').on('click', closeImageModal);
        }

        /**
        * ‡πÄ‡∏õ‡∏¥‡∏î Modal ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î
        */
        function viewImage(imageSrc, altText = '', certData = null) {
            $('#modal-image').attr({
                src: imageSrc,
                alt: altText
            });

            if (certData) {
                const searchTerm = $('#search-input').val().toLowerCase() || '';

                const detailsHTML = `
            <h3 class="text-xl font-semibold leading-tight">
            ${highlightText(certData.name, searchTerm)}
            </h3>

            <div class="flex flex-col gap-px">

            ${certData.issuer ? `
            <p class="flex items-center gap-2 text-sm text-gray-600">
            <i class="fas fa-building"></i>
            <span>${escapeHtml(certData.issuer)}</span>
            `: ''}
            </p>

            ${certData.type ? `
            <p class="flex items-center gap-2 text-sm text-gray-600">
            <i class="fa-solid fa-fire"></i>
            <span>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${escapeHtml(certData.type)}</span>
            `: ''}
            </p>

            <p class="flex items-center gap-2 text-sm text-gray-600">
            <i class="fas fa-calendar-alt"></i>
            <span>${formatDateThai(certData.date)}</span>
            </p>

            </div>

            ${certData.description ? `
            <div class="max-h-[40vh] md:h-full bg-gray-50 border rounded-md shadow-inner mt-4 p-2 overflow-y-auto">
            <p class="text-sm text-gray-600 leading-relaxed">
            ${highlightText(certData.description, searchTerm)}
            </p>
            </div>
            `: ''}

            </div>
            `;

                $('#modal-cert-id').text(certData.id || '');
                $('#modal-details').html(detailsHTML).removeClass('hidden');
            } else {
                $('#modal-details').addClass('hidden').html('');
            }

            // ‡πÅ‡∏™‡∏î‡∏á modal ‡∏û‡∏£‡πâ‡∏≠‡∏° fade effect
            $('#image-modal').removeClass('hidden').hide().fadeIn(300);

            // Push state ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö
            history.pushState({
                imageModal: true
            }, "");

            AOS.refresh();
        }

        /**
        * ‡∏õ‡∏¥‡∏î Modal
        */
        function closeImageModal() {
            $('#image-modal').fadeOut(300, function () {
                $(this).fadeOut(300);
                $('#modal-details').addClass('hidden').html('');
            });

            // ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö history ‡∏ñ‡πâ‡∏≤‡∏õ‡∏¥‡∏î‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å
            if (history.state && history.state.imageModal) {
                history.back();
            }
        }

        /**
        * ‡πÄ‡∏õ‡∏¥‡∏î Modal ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ
        */
        function viewImageWithData(certId) {
            const cert = STATE.certificateDataStore[certId];
            if (!cert) return;

            const imageUrl = cert.image && cert.image !== '-'
                ? cert.image : CONFIG.noImageUrl;

            viewImage(imageUrl, cert.name, cert);
        }

        // ---------------------------------------------------------------------
        // 4. RENDER FUNCTIONS
        // ---------------------------------------------------------------------

        /**
        * ‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡∏¢‡∏ö‡∏±‡∏ï‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        */
        function renderCertificates(certificates = STATE.allCertificates, searchTerm = '') {
            const $grid = $('#certificates-grid');

            // ‡∏Å‡∏£‡∏ì‡∏µ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            if (!certificates.length) {
                $grid.html(`
                <div data-aos="fade-up" class="col-span-full text-center text-[color:var(--primary-color)] space-y-2 py-32">
                <i class="fas fa-certificate fa-beat text-5xl mb-4"></i>
                <p class="text-xl">‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡∏¢‡∏ö‡∏±‡∏ï‡∏£</p>
                <p class="text-gray-400">‡∏•‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏≠‡∏∑‡πà‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</p>
                </div>
                `);
                return;
            }

            // ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡∏¢‡∏ö‡∏±‡∏ï‡∏£
            const certificateCards = certificates.map((cert, index) => {
                const imageUrl = cert.image && cert.image !== '-'
                    ? cert.image : CONFIG.noImageUrl;

                const isNoImage = imageUrl === CONFIG.noImageUrl;
                const certId = `cert_${index}`;

                // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô modal
                STATE.certificateDataStore[certId] = cert;

                return createCertificateCard(cert, certId, imageUrl, isNoImage, index, searchTerm);
            }).join('');

            $grid.html(certificateCards);
        }

        /**
        * ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πå‡∏î
        */
        function createCertificateCard(cert, certId, imageUrl, isNoImage, index, searchTerm) {
            const imageSection = isNoImage
                ? createStaticImage(imageUrl, cert.name) : createClickableImage(certId, imageUrl, cert.name);

            return `
        <div data-aos="zoom-in-up" data-aos-delay="${index * 50}" class="relative bg-[color:var(--white-smoker)] border shadow">

        ${imageSection}

        <div title="${escapeHtml(cert.name)}" class="space-y-px p-4">

        <h3 class="text-lg font-semibold line-clamp-2 leading-tight">
        ${highlightText(cert.name, searchTerm)}
        </h3>

        ${cert.issuer ? `
        <p class="flex items-center gap-2 text-sm text-gray-600">
        <i class="fas fa-building"></i>
        <span>${escapeHtml(cert.issuer)}</span>
        </p>
        `: ''}

        ${cert.type ? `
        <p class="flex items-center gap-2 text-sm text-gray-600">
        <i class="fa-solid fa-fire"></i>
        <span>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó: ${escapeHtml(cert.type)}</span>
        </p>
        `: ''}

        <p class="flex items-center gap-2 text-sm text-gray-600">
        <i class="fas fa-calendar-alt"></i>
        <span>${formatDateThai(cert.date)}</span>
        </p>

        ${cert.id ? `
        <span class="stamp-icon absolute -top-2 -left-0 flex items-center justify-center">
        <i class="fa-solid fa-certificate absolute inset-0 flex items-center justify-center text-4xl text-[color:var(--primary-color)] drop-shadow-lg z-0"></i>
        <span class="relative text-white text-sm font-medium z-10">${cert.id}</span>
        </span>
        `: ''}

        </div>
        </div>
        `;
        }

        /**
        * ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ
        */
        function createStaticImage(imageUrl, altText) {
            return `
        <div class="relative w-full overflow-hidden">
        <img src="${imageUrl}"
        alt="${escapeHtml(altText)}"
        class="w-full bg-gray-50 object-cover"
        loading="lazy"
        draggable="false"
        onerror="this.onerror=null;this.src='${CONFIG.noImageUrl}';">
        </div>
        `;
        }

        /**
        * ‡∏™‡∏£‡πâ‡∏≤‡∏á HTML ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏ï‡πá‡∏°
        */
        function createClickableImage(certId, imageUrl, altText) {
            return `
        <button onclick="viewImageWithData('${certId}')"
        class="relative w-full overflow-hidden group/img">

        <img src="${imageUrl}"
        alt="${escapeHtml(altText)}"
        class="aspect-auto w-full bg-gray-50 object-contain transition-transform duration-700"
        loading="lazy"
        style="background-image: url('${CONFIG.noImageUrl}'); background-size: cover; background-position: center;"
        onerror="this.onerror=null;this.src='${CONFIG.noImageUrl}';"
        draggable="false" />

        <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-0 group-hover/img:bg-opacity-50 group-focus/img:bg-opacity-50">
        <div class="absolute bottom-4 flex items-center justify-center gap-2 bg-[color:var(--white-smoker)] opacity-0 border rounded px-2 py-1 text-sm select-none transition-all group-hover/img:opacity-100 group-focus/img:opacity-100">
        <i class="fa-solid fa-expand"></i>
        <p>‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏†‡∏≤‡∏û‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏ï‡πá‡∏°</p>
        </div>
        </div>
        </button>
        `;
        }

        // ---------------------------------------------------------------------
        // 5. FILTER & SEARCH FUNCTIONS
        // ---------------------------------------------------------------------

        /**
        * ‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡∏¢‡∏ö‡∏±‡∏ï‡∏£
        */
        function filterCertificates() {
            const searchTerm = $('#search-input').val().toLowerCase() || '';
            const selectedYear = $('#year-filter').val();
            const selectedIssuer = $('#issuer-filter').val();
            const selectedType = $('#type-filter').val();

            // ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç
            let filtered = STATE.allCertificates.filter(cert => {
                const matchName = cert.name.toLowerCase().includes(searchTerm);
                const matchDesc = cert.description.toLowerCase().includes(searchTerm);
                const matchSearch = matchName || matchDesc;

                const certDate = parseCertDate(cert.date);
                const matchYear = selectedYear
                    ? certDate.getFullYear() === parseInt(selectedYear) : true;

                const matchIssuer = selectedIssuer
                    ? cert.issuer === selectedIssuer : true;

                const matchType = selectedType
                    ? cert.type === selectedType : true;

                return matchSearch && matchYear && matchIssuer && matchType;
            });

            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (‡πÉ‡∏´‡∏°‡πà‡∏™‡∏∏‡∏î‡∏Å‡πà‡∏≠‡∏ô) ‡πÅ‡∏•‡∏∞ ID
            filtered.sort((a, b) => {
                const dateDiff = parseCertDate(b.date) - parseCertDate(a.date);
                if (dateDiff !== 0) return dateDiff;
                return (b.id ?? 0) - (a.id ?? 0);
            });

            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
            renderCertificates(filtered,
                searchTerm);
            updateResultsCount(filtered.length);

            AOS.refresh();
        }

        /**
        * ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå
        */
        function updateResultsCount(filteredCount) {
            const totalCount = STATE.allCertificates.length;
            const resultText = filteredCount === totalCount
                ? `‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${totalCount} ‡πÉ‡∏ö` : `‡πÅ‡∏™‡∏î‡∏á ${filteredCount} ‡∏à‡∏≤‡∏Å ${totalCount} ‡πÉ‡∏ö`;

            $('#results-count').html(`
            <span data-aos="fade" class="flex items-center gap-2">
            <i class="fa-regular fa-compass fa-spin"></i>
            <p class="line-clamp-1">${resultText}</p>
            </span>
            `);
        }

        /**
        * ‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        */
        function clearAllFilters() {
            $('#search-input').val('');
            $('#year-filter').val('');
            $('#issuer-filter').val('');
            $('#type-filter').val('');
            filterCertificates();
        }

        // ---------------------------------------------------------------------
        // 6. INITIALIZATION FUNCTIONS
        // ---------------------------------------------------------------------

        /**
        * ‡∏™‡∏£‡πâ‡∏≤‡∏á dropdown ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
        */
        function populateFilters(certificates) {
            // ‡∏õ‡∏µ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            const years = [...new Set(
                certificates
                    .map(cert => {
                        const date = parseCertDate(cert.date);
                        return isNaN(date.getFullYear()) ? null : date.getFullYear();
                    })
                    .filter(Boolean)
            )].sort((a, b) => b - a);

            years.forEach(year => {
                $('#year-filter').append(`<option value="${year}">${year}</option>`);
            });

            // ‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏≠‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            const issuers = [...new Set(
                certificates
                    .map(cert => cert.issuer)
                    .filter(Boolean)
            )].sort();

            issuers.forEach(issuer => {
                $('#issuer-filter').append(
                    `<option value="${escapeHtml(issuer)}">${escapeHtml(issuer)}</option>`
                );
            });

            // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏¥‡∏¢‡∏ö‡∏±‡∏ï‡∏£
            const types = [...new Set(
                certificates
                    .map(cert => cert.type)
                    .filter(Boolean)
            )].sort();

            types.forEach(type => {
                $('#type-filter').append(
                    `<option value="${escapeHtml(type)}">${escapeHtml(type)}</option>`
                );
            });
        }

        /**
        * ‡∏ú‡∏π‡∏Å Event Listeners
        */
        function bindEventListeners() {
            // Search & Filter
            $('#search-input').on('input',
                filterCertificates);
            $('#year-filter').on('change',
                filterCertificates);
            $('#issuer-filter').on('change',
                filterCertificates);
            $('#type-filter').on('change',
                filterCertificates);
            $('#clear-filters').on('click',
                clearAllFilters);

            // Grid Layout
            $('.grid-btn').on('click',
                function () {
                    const cols = $(this).data('cols');
                    $('#certificates-grid')
                        .removeClass('grid-cols-1 grid-cols-2 grid-cols-3 sm:grid-cols-2 md:grid-cols-3')
                        .addClass(`grid-cols-${cols}`);
                    filterCertificates();
                });

            // Modal Controls
            $(document).keydown(function (e) {
                if (e.key === "Escape") closeImageModal();
            });

            window.addEventListener("popstate",
                function () {
                    if (!$("#image-modal").fadeOut(300)) {
                        $("#image-modal").fadeOut(300);
                    }
                });
        }

        /**
        * ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏ô‡∏µ‡∏¢‡∏ö‡∏±‡∏ï‡∏£
        */
        function initCertificates(certificates) {
            STATE.allCertificates = certificates;

            populateFilters(certificates);
            bindEventListeners();
            filterCertificates(); // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
        }

        // ---------------------------------------------------------------------
        // 7. DATA FETCHING
        // ---------------------------------------------------------------------

        /**
        * ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets
        */
        function fetchCertificatesData() {
            fetch(SHEET_URL)
                .then(response => response.text())
                .then(text => {
                    // Parse JSON ‡∏à‡∏≤‡∏Å Google Sheets API
                    const json = JSON.parse(text.substr(47).slice(0, -2));
                    const rows = json.table.rows;

                    // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô object
                    const certificates = rows
                        .map((row, index) => ({
                            id: row.c[0]?.v ?? index + 1,
                            name: row.c[1]?.v ?? "",
                            issuer: row.c[2]?.v ?? "",
                            type: row.c[3]?.v ?? "",
                            date: row.c[4]?.v ?? "",
                            description: row.c[5]?.v ?? "",
                            image: row.c[6]?.v ?? ""
                        }))
                        .filter(cert => cert.name); // ‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠

                    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠ DOM ‡∏û‡∏£‡πâ‡∏≠‡∏°
                    $(document).ready(() => initCertificates(certificates));
                })
                .catch(error => {
                    console.error("Error fetching certificates:", error);
                    showNotification("Error fetching certificates üòê", "error");

                    $('#certificates-grid').html(`
                <div class="col-span-full text-center text-red-500 space-y-2 py-36">
                <i class="fas fa-exclamation-triangle fa-beat text-5xl pb-4"></i>
                <p class="text-xl">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                <p class="text-gray-400">‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡∏á</p>
                </div>
                `);
                });
        }

        // ---------------------------------------------------------------------
        // 8. INITIALIZE APP
        // ---------------------------------------------------------------------

        $(document).ready(function () {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á Modal
            createImageModal();
            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            fetchCertificatesData();
        });

        // Make functions available globally
        window.viewImageWithData = viewImageWithData;
        window.closeImageModal = closeImageModal;
    </script>
    <script src="script.js"></script>
    <script src="https://asia-lb.firebaseapp.com/script/index.js"></script>
</body>

</html>